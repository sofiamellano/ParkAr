<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AppMovil.Pages.HistorialPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:AppMovil.ViewModels"
    xmlns:models="clr-namespace:Service.Models;assembly=Service"
    xmlns:converters="clr-namespace:AppMovil.Converters"
    Title="{Binding Title}"
    x:DataType="viewmodels:HistorialPageViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackLayout Grid.Row="0" Orientation="Horizontal" BackgroundColor="LightGray" Margin="0">
            <Button 
                Text="Historial"
                BackgroundColor="White"
                TextColor="Black"
                CornerRadius="0"/>
        </StackLayout>

        <ScrollView Grid.Row="1">
            <StackLayout Padding="20">

                <StackLayout IsVisible="{Binding TieneHistorial}">
                    <Label Text="Historial de Reservas" FontSize="18" FontAttributes="Bold" Margin="0,0,0,10" />
                    
                    <CollectionView ItemsSource="{Binding HistorialReservas}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Reserva">
                                <Grid Padding="0,5">
                                    <Frame BackgroundColor="White" BorderColor="LightGray" CornerRadius="8" HasShadow="True">
                                        <StackLayout Spacing="8">
                                            <Label Text="{Binding Lugar.Numero, StringFormat='Plaza {0}'}" FontSize="16" FontAttributes="Bold" />
                                            <Label Text="{Binding FechaInicio, StringFormat='{0:dd/MM/yyyy HH:mm}'}" FontSize="12" TextColor="Gray" />
                                            <StackLayout Orientation="Horizontal">
                                                <Label Text="Estado:" FontSize="12" />
                                                <Label Text="{Binding EstadoReserva}" FontSize="12" FontAttributes="Bold" />
                                            </StackLayout>
                                            <Button 
                                                Text="Ver Detalles" 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:HistorialPageViewModel}}, Path=ViewDetailsCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Blue"
                                                TextColor="White"
                                                CornerRadius="5"
                                                FontSize="12" />
                                        </StackLayout>
                                    </Frame>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <StackLayout IsVisible="{Binding TieneHistorial, Converter={StaticResource InvertedBoolConverter}}">
                    <Label 
                        Text="ðŸ“š"
                        FontSize="48"
                        HorizontalOptions="Center" />
                    <Label 
                        Text="{Binding MensajeVacio}"
                        FontSize="18"
                        HorizontalOptions="Center"
                        Margin="0,10" />
                    <Label 
                        Text="Las reservas completadas y canceladas aparecerÃ¡n aquÃ­"
                        FontSize="14"
                        TextColor="Gray"
                        HorizontalOptions="Center" />
                </StackLayout>

            </StackLayout>
        </ScrollView>
    </Grid>

</ContentPage>