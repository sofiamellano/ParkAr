<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AppMovil.Pages.PerfilPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:AppMovil.ViewModels"
    xmlns:models="clr-namespace:Service.Models;assembly=Service"
    xmlns:converters="clr-namespace:AppMovil.Converters"
    Title="{Binding Title}"
    x:DataType="viewmodels:PerfilPageViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Padding="20" Spacing="20">

            <!-- âœ… PERFIL DEL USUARIO -->
            <Frame BackgroundColor="#4ECDC4" BorderColor="Transparent" CornerRadius="15" Padding="20" HasShadow="True">
                <StackLayout Spacing="10">
                    <Label Text="ðŸ‘¤" FontSize="48" HorizontalOptions="Center" TextColor="White" />
                    <Label 
                        Text="{Binding NombreUsuario}" 
                        FontSize="20" 
                        FontAttributes="Bold" 
                        TextColor="White"
                        HorizontalOptions="Center" />
                    <Label 
                        Text="{Binding EmailUsuario}" 
                        FontSize="14" 
                        TextColor="White"
                        HorizontalOptions="Center" />
                </StackLayout>
            </Frame>

            <!-- âœ… INDICADOR DE CARGA -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              IsVisible="{Binding IsBusy}"
                              Color="#4ECDC4"
                              HeightRequest="40" />

            <!-- âœ… SECCIÃ“N DE VEHÃCULOS -->
            <StackLayout Spacing="15">
                <StackLayout Orientation="Horizontal">
                    <Label Text="ðŸš— Mis VehÃ­culos" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" />
                    <Button Text="+"
                            Command="{Binding AgregarVehiculoCommand}"
                            BackgroundColor="#27AE60"
                            TextColor="White"
                            WidthRequest="40"
                            HeightRequest="40"
                            CornerRadius="20"
                            FontSize="20"
                            FontAttributes="Bold"/>
                </StackLayout>

                <!-- Lista de vehÃ­culos o mensaje vacÃ­o -->
                <StackLayout IsVisible="{Binding TieneVehiculos}">
                    <CollectionView ItemsSource="{Binding VehiculosUsuario}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Vehiculo">
                                <Grid Padding="0" Margin="0,5">
                                    <Frame BackgroundColor="White" 
                                           BorderColor="LightGray" 
                                           CornerRadius="10"
                                           HasShadow="True"
                                           Padding="15">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <StackLayout Grid.Column="0" Spacing="5">
                                                <Label Text="{Binding Patente}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold"
                                                       TextColor="#2C3E50" />
                                                <Label Text="{Binding TipoVehiculo}" 
                                                       FontSize="14"
                                                       TextColor="#7F8C8D" />
                                            </StackLayout>
                                            
                                            <Button Grid.Column="1"
                                                    Text="âš™ï¸"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PerfilPageViewModel}}, Path=EditarVehiculoCommand}"
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="Transparent"
                                                    TextColor="#3498DB"
                                                    FontSize="18"
                                                    WidthRequest="40"
                                                    HeightRequest="40" />
                                        </Grid>
                                    </Frame>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

                <!-- Mensaje cuando no hay vehÃ­culos -->
                <Frame IsVisible="{Binding TieneVehiculos, Converter={StaticResource InvertedBoolConverter}}"
                       BackgroundColor="#F8F9FA"
                       BorderColor="#DEE2E6"
                       CornerRadius="10"
                       Padding="20">
                    <StackLayout HorizontalOptions="Center" Spacing="10">
                        <Label Text="ðŸš—" FontSize="32" HorizontalOptions="Center" TextColor="#6C757D" />
                        <Label Text="No tienes vehÃ­culos registrados" 
                               FontSize="16" 
                               TextColor="#495057"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Agrega tu primer vehÃ­culo para poder hacer reservas" 
                               FontSize="12" 
                               TextColor="#6C757D"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center" />
                    </StackLayout>
                </Frame>
            </StackLayout>

            <!-- âœ… SECCIÃ“N MI CUENTA -->
            <StackLayout Spacing="15">
                <Label Text="ðŸ‘¤ Mi Cuenta" FontSize="18" FontAttributes="Bold" />

                <Frame BackgroundColor="White" BorderColor="LightGray" CornerRadius="10" HasShadow="True" Padding="0">
                    <StackLayout Spacing="0">
                        <Button 
                            Text="ðŸ“ Editar Perfil"
                            Command="{Binding EditProfileCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#2C3E50"
                            BorderWidth="0"
                            HeightRequest="50"
                            FontSize="16" />
                        
                        <BoxView BackgroundColor="LightGray" HeightRequest="1" />
                        
                        <Button 
                            Text="ðŸ”’ Cambiar ContraseÃ±a"
                            Command="{Binding ChangePasswordCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#2C3E50"
                            BorderWidth="0"
                            HeightRequest="50"
                            FontSize="16" />
                    </StackLayout>
                </Frame>
            </StackLayout>

            <!-- âœ… SECCIÃ“N CONFIGURACIÃ“N Y AYUDA -->
            <StackLayout Spacing="15">
                <Label Text="âš™ï¸ ConfiguraciÃ³n" FontSize="18" FontAttributes="Bold" />

                <Frame BackgroundColor="White" BorderColor="LightGray" CornerRadius="10" HasShadow="True" Padding="0">
                    <StackLayout Spacing="0">
                        <Button 
                            Text="ðŸ”§ ConfiguraciÃ³n"
                            Command="{Binding ShowSettingsCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#2C3E50"
                            BorderWidth="0"
                            HeightRequest="50"
                            FontSize="16" />
                        
                        <BoxView BackgroundColor="LightGray" HeightRequest="1" />
                        
                        <Button 
                            Text="â“ Ayuda y Soporte"
                            Command="{Binding ShowHelpCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#2C3E50"
                            BorderWidth="0"
                            HeightRequest="50"
                            FontSize="16" />
                    </StackLayout>
                </Frame>
            </StackLayout>

            <!-- âœ… BOTÃ“N CERRAR SESIÃ“N -->
            <Button 
                Text="ðŸšª Cerrar SesiÃ³n"
                Command="{Binding LogoutCommand}"
                BackgroundColor="#E74C3C"
                TextColor="White"
                CornerRadius="10"
                HeightRequest="50"
                FontSize="16"
                FontAttributes="Bold"
                Margin="0,20,0,0" />

        </StackLayout>
    </ScrollView>

</ContentPage>