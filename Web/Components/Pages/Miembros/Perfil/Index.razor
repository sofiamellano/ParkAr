@page "/miembros/perfil"
@inject IUsuarioService _usuarioService
@inject IVehiculoService _vehiculoService
@inject IReservaService _reservaService
@inject FirebaseAuthService _firebaseAuthService
@inject SweetAlertService _sweetAlert
@inject NavigationManager _navigationManager
@rendermode InteractiveServer

<PageTitle>Mi Perfil - ParkAR</PageTitle>

@if (!isAuthenticated && !isLoading)
{
    <div class="container-fluid py-5">
        <div class="row justify-content-center">
            <div class="col-md-6 text-center">
                <i class="bi bi-shield-lock display-1 text-muted"></i>
                <h3 class="mt-3">Acceso Restringido</h3>
                <p class="text-muted">Debes iniciar sesión para acceder a tu perfil.</p>
                <button class="btn btn-primary" @onclick='() => _navigationManager.NavigateTo("/login")'>
                    <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
                </button>
            </div>
        </div>
    </div>
}
else if (isLoading)
{
    <div class="container-fluid py-5">
        <div class="row justify-content-center">
            <div class="col-md-6 text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <h5 class="mt-3">Cargando perfil...</h5>
            </div>
        </div>
    </div>
}
else
{
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="/miembros/dashboard" class="text-decoration-none">
                        <i class="bi bi-house me-1"></i>Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Mi Perfil</li>
            </ol>
        </nav>

        <!-- Header del perfil -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <div class="avatar-lg bg-gradient-primary rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-person-fill fs-2 text-white"></i>
                                </div>
                            </div>
                            <div class="col">
                                <h2 class="mb-1">@(usuario?.Nombre ?? "Usuario")</h2>
                                <p class="text-muted mb-2">
                                    <i class="bi bi-envelope me-2"></i>@(usuario?.Email ?? "No disponible")
                                </p>
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge bg-success-subtle text-success">
                                        <i class="bi bi-check-circle me-1"></i>Cuenta Verificada
                                    </span>
                                    <span class="badge bg-info-subtle text-info">
                                        <i class="bi bi-person-badge me-1"></i>@(usuario?.TipoUsuario.ToString() ?? "Cliente")
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary" @onclick="MostrarEditarPerfil">
                                        <i class="bi bi-pencil me-2"></i>Editar Perfil
                                    </button>
                                    <button class="btn btn-outline-secondary" @onclick="MostrarCambiarPassword">
                                        <i class="bi bi-key me-2"></i>Cambiar Contraseña
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="row">
            <!-- Mis Vehículos -->
            <div class="col-lg-8 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-bottom">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-car-front me-2 text-primary"></i>Mis Vehículos
                                <span class="badge bg-primary ms-2">@vehiculos.Count</span>
                            </h5>
                            <button class="btn btn-primary btn-sm" @onclick="MostrarAgregarVehiculo">
                                <i class="bi bi-plus-lg me-1"></i>Agregar Vehículo
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        @if (vehiculos.Any())
                        {
                            <div class="row g-3">
                                @foreach (var vehiculo in vehiculos)
                                {
                                    <div class="col-md-6">
                                        <div class="card border-start border-4 @GetVehiculoBorderClass(vehiculo.TipoVehiculo) h-100">
                                            <div class="card-body p-3">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <div class="d-flex align-items-center mb-2">
                                                            <i class="@GetVehiculoIcon(vehiculo.TipoVehiculo) me-2 text-primary"></i>
                                                            <h6 class="fw-bold mb-0">@vehiculo.Patente</h6>
                                                        </div>
                                                        <p class="text-muted small mb-1">
                                                            <i class="bi bi-tag me-1"></i>@vehiculo.TipoVehiculo
                                                        </p>
                                                        <small class="text-success">
                                                            <i class="bi bi-check-circle me-1"></i>Verificado
                                                        </small>
                                                    </div>
                                                    <div class="dropdown">
                                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                                                                type="button" data-bs-toggle="dropdown">
                                                            <i class="bi bi-three-dots-vertical"></i>
                                                        </button>
                                                        <ul class="dropdown-menu">
                                                            <li>
                                                                <button class="dropdown-item" @onclick="() => EditarVehiculo(vehiculo)">
                                                                    <i class="bi bi-pencil me-2"></i>Editar Patente
                                                                </button>
                                                            </li>
                                                            <li>
                                                                <button class="dropdown-item" @onclick="() => CambiarTipoVehiculo(vehiculo)">
                                                                    <i class="bi bi-arrow-repeat me-2"></i>Cambiar Tipo
                                                                </button>
                                                            </li>
                                                            <li><hr class="dropdown-divider"></li>
                                                            <li>
                                                                <button class="dropdown-item text-danger" @onclick="() => EliminarVehiculo(vehiculo)">
                                                                    <i class="bi bi-trash me-2"></i>Eliminar
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-5">
                                <div class="mb-4">
                                    <i class="bi bi-car-front display-3 text-muted"></i>
                                </div>
                                <h5 class="text-muted mb-3">No tienes vehículos registrados</h5>
                                <p class="text-muted mb-4">Agrega tu primer vehículo para comenzar a hacer reservas de estacionamiento.</p>
                                <button class="btn btn-primary btn-lg" @onclick="MostrarAgregarVehiculo">
                                    <i class="bi bi-plus-lg me-2"></i>Agregar Primer Vehículo
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Panel lateral -->
            <div class="col-lg-4">
                <!-- Estadísticas -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-graph-up me-2 text-success"></i>Estadísticas del Perfil
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="border-end pe-3">
                                    <div class="d-flex align-items-center justify-content-center mb-2">
                                        <div class="bg-primary rounded-circle p-2">
                                            <i class="bi bi-car-front text-white"></i>
                                        </div>
                                    </div>
                                    <h4 class="text-primary mb-1 fw-bold">@vehiculos.Count</h4>
                                    <small class="text-muted">Vehículos</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="ps-3">
                                    <div class="d-flex align-items-center justify-content-center mb-2">
                                        <div class="bg-success rounded-circle p-2">
                                            <i class="bi bi-calendar-check text-white"></i>
                                        </div>
                                    </div>
                                    <h4 class="text-success mb-1 fw-bold">@totalReservas</h4>
                                    <small class="text-muted">Reservas</small>
                                </div>
                            </div>
                        </div>
                        <hr class="my-3">
                        <div class="d-flex justify-content-between text-muted small">
                            <span>Miembro desde:</span>
                            <span>@DateTime.Now.ToString("MMM yyyy")</span>
                        </div>
                    </div>
                </div>

                <!-- Acciones rápidas -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-lightning-fill me-2 text-warning"></i>Acciones Rápidas
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <button class="list-group-item list-group-item-action d-flex align-items-center py-3" 
                                    @onclick='() => _navigationManager.NavigateTo("/miembros/reservas/crear")'>
                                <div class="bg-success rounded-circle p-2 me-3">
                                    <i class="bi bi-plus text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Nueva Reserva</h6>
                                    <small class="text-muted">Reservar un lugar de estacionamiento</small>
                                </div>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </button>
                            <button class="list-group-item list-group-item-action d-flex align-items-center py-3"
                                    @onclick='() => _navigationManager.NavigateTo("/miembros/reservas")'>
                                <div class="bg-primary rounded-circle p-2 me-3">
                                    <i class="bi bi-list-ul text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Mis Reservas</h6>
                                    <small class="text-muted">Ver y gestionar reservas activas</small>
                                </div>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </button>
                            <button class="list-group-item list-group-item-action d-flex align-items-center py-3"
                                    @onclick='() => _navigationManager.NavigateTo("/miembros/suscripciones")'>
                                <div class="bg-info rounded-circle p-2 me-3">
                                    <i class="bi bi-credit-card text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">Suscripciones</h6>
                                    <small class="text-muted">Gestionar planes y pagos</small>
                                </div>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private bool isAuthenticated = false;
    private bool isLoading = true;
    private bool isInitialized = false;
    private Usuario? usuario;
    private List<Vehiculo> vehiculos = new();
    private int totalReservas = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Console.WriteLine("Perfil: Verificando autenticación...");
            isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
            Console.WriteLine($"Perfil: Autenticado = {isAuthenticated}");
            
            if (isAuthenticated)
            {
                await CargarDatosUsuario();
                await CargarVehiculos();
                await CargarEstadisticas();
            }
            
            isLoading = false;
            isInitialized = true;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al verificar autenticación en Perfil: {ex.Message}");
            await _sweetAlert.FireAsync("Error", $"Error al cargar el perfil: {ex.Message}", SweetAlertIcon.Error);
            isAuthenticated = false;
            isLoading = false;
            isInitialized = true;
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !isInitialized)
        {
            try
            {
                Console.WriteLine("Perfil OnAfterRenderAsync: Verificando autenticación...");
                isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
                Console.WriteLine($"Perfil OnAfterRenderAsync: Autenticado = {isAuthenticated}");
                
                if (isAuthenticated)
                {
                    await CargarDatosUsuario();
                    await CargarVehiculos();
                    await CargarEstadisticas();
                }
                
                isLoading = false;
                StateHasChanged();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error en Perfil OnAfterRenderAsync: {ex.Message}");
                await _sweetAlert.FireAsync("Error", $"Error al cargar el perfil: {ex.Message}", SweetAlertIcon.Error);
                isAuthenticated = false;
                isLoading = false;
                StateHasChanged();
            }
        }
    }

    private async Task CargarDatosUsuario()
    {
        try
        {
            Console.WriteLine("Perfil: Cargando datos del usuario...");
            var firebaseUser = _firebaseAuthService.CurrentUser;
            Console.WriteLine($"Perfil: FirebaseUser = {firebaseUser?.Email}");
            
            if (firebaseUser != null)
            {
                var usuarios = await _usuarioService.GetAllAsync();
                usuario = usuarios?.FirstOrDefault(u => u.Email == firebaseUser.Email);
                
                if (usuario == null)
                {
                    Console.WriteLine("Perfil: Usuario no encontrado en BD, creando...");
                    usuario = new Usuario
                    {
                        Email = firebaseUser.Email,
                        Nombre = firebaseUser.DisplayName ?? "Usuario",
                        Password = "",
                        TipoUsuario = Service.Enums.TipoUsuarioEnum.Cliente
                    };
                    
                    usuario = await _usuarioService.AddAsync(usuario);
                    Console.WriteLine($"Perfil: Usuario creado con ID {usuario.Id}");
                }
                else
                {
                    Console.WriteLine($"Perfil: Usuario encontrado con ID {usuario.Id}");
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cargar datos del usuario: {ex.Message}");
        }
    }

    private async Task CargarVehiculos()
    {
        try
        {
            if (usuario != null)
            {
                Console.WriteLine($"Perfil: Cargando vehículos para usuario {usuario.Id}...");
                var vehiculosList = await _vehiculoService.GetByUsuarioAsync(usuario.Id);
                vehiculos = vehiculosList?.ToList() ?? new List<Vehiculo>();
                Console.WriteLine($"Perfil: Total vehículos cargados = {vehiculos.Count}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cargar vehículos: {ex.Message}");
            vehiculos = new List<Vehiculo>();
        }
    }

    private async Task CargarEstadisticas()
    {
        try
        {
            if (usuario != null)
            {
                Console.WriteLine($"Perfil: Cargando estadísticas para usuario {usuario.Id}...");
                var reservas = await _reservaService.GetByUsuarioAsync(usuario.Id);
                totalReservas = reservas?.Count ?? 0;
                Console.WriteLine($"Perfil: Total reservas = {totalReservas}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error al cargar estadísticas: {ex.Message}");
            totalReservas = 0;
        }
    }

    private async Task MostrarEditarPerfil()
    {
        var nombreActual = usuario?.Nombre ?? "";
        
        var resultado = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Editar Perfil",
            Html = $@"
                <div class='mb-3'>
                    <label class='form-label'>Nombre completo</label>
                    <input type='text' id='nombre-input' class='form-control' value='{nombreActual}' placeholder='Ingresa tu nombre completo'>
                </div>
                <div class='text-muted small'>
                    <i class='bi bi-info-circle me-1'></i>
                    Tu email no puede modificarse ya que está vinculado a Firebase.
                </div>
            ",
            ShowCancelButton = true,
            ConfirmButtonText = "Guardar Cambios",
            CancelButtonText = "Cancelar",
            // PreConfirm = new PreConfirmCallback(async () => {
            //     var nombre = await _sweetAlert.GetInputValueAsync("nombre-input");
            //     if (string.IsNullOrWhiteSpace(nombre))
            //     {
            //         await _sweetAlert.ShowValidationMessage("El nombre es requerido");
            //         return false;
            //     }
            //     return nombre;
            // })
        });

        if (resultado.IsConfirmed && !string.IsNullOrWhiteSpace(resultado.Value))
        {
            try
            {
                if (usuario != null)
                {
                    usuario.Nombre = resultado.Value;
                    await _usuarioService.UpdateAsync(usuario);
                    await _sweetAlert.FireAsync("¡Éxito!", "Perfil actualizado correctamente", SweetAlertIcon.Success);
                    StateHasChanged();
                }
            }
            catch (Exception ex)
            {
                await _sweetAlert.FireAsync("Error", $"No se pudo actualizar el perfil: {ex.Message}", SweetAlertIcon.Error);
            }
        }
    }

    private async Task MostrarCambiarPassword()
    {
        var resultado = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Cambiar Contraseña",
            Text = "Se enviará un correo de recuperación a tu email registrado.",
            Icon = SweetAlertIcon.Info,
            ShowCancelButton = true,
            ConfirmButtonText = "Enviar Correo",
            CancelButtonText = "Cancelar"
        });

        if (resultado.IsConfirmed && usuario != null)
        {
            try
            {
                // Implementar lógica de cambio de contraseña con Firebase
                await _sweetAlert.FireAsync("Correo Enviado", "Revisa tu bandeja de entrada para cambiar tu contraseña.", SweetAlertIcon.Success);
            }
            catch (Exception ex)
            {
                await _sweetAlert.FireAsync("Error", $"No se pudo enviar el correo: {ex.Message}", SweetAlertIcon.Error);
            }
        }
    }

    private async Task MostrarAgregarVehiculo()
    {
        var patente = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Agregar Nuevo Vehículo",
            Input = SweetAlertInputType.Text,
            InputLabel = "Patente del vehículo",
            InputPlaceholder = "Ej: ABC123, AB123CD",
            ShowCancelButton = true,
            ConfirmButtonText = "Continuar",
            CancelButtonText = "Cancelar",
            InputValidator = new InputValidatorCallback((string input) =>
            {
                if (string.IsNullOrWhiteSpace(input))
                    return "La patente es requerida";
                if (input.Length < 3)
                    return "La patente debe tener al menos 3 caracteres";
                if (vehiculos.Any(v => v.Patente.Equals(input.ToUpper(), StringComparison.OrdinalIgnoreCase)))
                    return "Ya tienes un vehículo con esta patente";
                return null;
            })
        });

        if (patente.IsConfirmed && !string.IsNullOrWhiteSpace(patente.Value))
        {
            var tipoVehiculo = await _sweetAlert.FireAsync(new SweetAlertOptions
            {
                Title = "Tipo de Vehículo",
                Text = $"Selecciona el tipo para {patente.Value.ToUpper()}",
                Input = SweetAlertInputType.Select,
                InputOptions = new Dictionary<string, string>
                {
                    {"Auto", "🚗 Auto"},
                    {"Moto", "🏍️ Moto"},
                    {"Camioneta", "🚙 Camioneta"},
                    {"Bicicleta", "🚲 Bicicleta"}
                },
                ShowCancelButton = true,
                ConfirmButtonText = "Agregar Vehículo",
                CancelButtonText = "Cancelar"
            });

            if (tipoVehiculo.IsConfirmed && !string.IsNullOrWhiteSpace(tipoVehiculo.Value))
            {
                try
                {
                    var nuevoVehiculo = new Vehiculo
                    {
                        UsuarioId = usuario!.Id,
                        Patente = patente.Value.ToUpper(),
                        TipoVehiculo = Enum.Parse<Service.Enums.TipoVehiculoEnum>(tipoVehiculo.Value)
                    };

                    await _vehiculoService.AddAsync(nuevoVehiculo);
                    await _sweetAlert.FireAsync("¡Vehículo Agregado!", $"El vehículo {patente.Value.ToUpper()} se agregó correctamente.", SweetAlertIcon.Success);
                    await CargarVehiculos();
                    StateHasChanged();
                }
                catch (Exception ex)
                {
                    await _sweetAlert.FireAsync("Error", $"No se pudo agregar el vehículo: {ex.Message}", SweetAlertIcon.Error);
                }
            }
        }
    }

    private async Task EditarVehiculo(Vehiculo vehiculo)
    {
        var nuevaPatente = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Editar Patente",
            Input = SweetAlertInputType.Text,
            InputValue = vehiculo.Patente,
            InputLabel = "Nueva patente del vehículo",
            ShowCancelButton = true,
            ConfirmButtonText = "Actualizar",
            CancelButtonText = "Cancelar",
            InputValidator = new InputValidatorCallback((string input) =>
            {
                if (string.IsNullOrWhiteSpace(input))
                    return "La patente es requerida";
                if (input.Length < 3)
                    return "La patente debe tener al menos 3 caracteres";
                if (vehiculos.Any(v => v.Id != vehiculo.Id && v.Patente.Equals(input.ToUpper(), StringComparison.OrdinalIgnoreCase)))
                    return "Ya tienes un vehículo con esta patente";
                return null;
            })
        });

        if (nuevaPatente.IsConfirmed && !string.IsNullOrWhiteSpace(nuevaPatente.Value))
        {
            try
            {
                vehiculo.Patente = nuevaPatente.Value.ToUpper();
                await _vehiculoService.UpdateAsync(vehiculo);
                await _sweetAlert.FireAsync("¡Actualizado!", "Patente actualizada correctamente", SweetAlertIcon.Success);
                await CargarVehiculos();
                StateHasChanged();
            }
            catch (Exception ex)
            {
                await _sweetAlert.FireAsync("Error", $"No se pudo actualizar la patente: {ex.Message}", SweetAlertIcon.Error);
            }
        }
    }

    private async Task CambiarTipoVehiculo(Vehiculo vehiculo)
    {
        var nuevoTipo = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Cambiar Tipo de Vehículo",
            Text = $"Vehículo: {vehiculo.Patente}",
            Input = SweetAlertInputType.Select,
            InputValue = vehiculo.TipoVehiculo.ToString(),
            InputOptions = new Dictionary<string, string>
            {
                {"Auto", "🚗 Auto"},
                {"Moto", "🏍️ Moto"},
                {"Camioneta", "🚙 Camioneta"},
                {"Bicicleta", "🚲 Bicicleta"}
            },
            ShowCancelButton = true,
            ConfirmButtonText = "Cambiar Tipo",
            CancelButtonText = "Cancelar"
        });

        if (nuevoTipo.IsConfirmed && !string.IsNullOrWhiteSpace(nuevoTipo.Value))
        {
            try
            {
                var tipoEnum = Enum.Parse<Service.Enums.TipoVehiculoEnum>(nuevoTipo.Value);
                vehiculo.TipoVehiculo = tipoEnum;
                await _vehiculoService.UpdateAsync(vehiculo);
                await _sweetAlert.FireAsync("¡Actualizado!", "Tipo de vehículo actualizado correctamente", SweetAlertIcon.Success);
                await CargarVehiculos();
                StateHasChanged();
            }
            catch (Exception ex)
            {
                await _sweetAlert.FireAsync("Error", $"No se pudo actualizar el tipo: {ex.Message}", SweetAlertIcon.Error);
            }
        }
    }

    private async Task EliminarVehiculo(Vehiculo vehiculo)
    {
        var resultado = await _sweetAlert.FireAsync(new SweetAlertOptions
        {
            Title = "Eliminar Vehículo",
            Html = $@"
                <div class='text-center mb-3'>
                    <i class='{GetVehiculoIcon(vehiculo.TipoVehiculo)} fs-1 text-danger'></i>
                </div>
                <p>¿Estás seguro de que deseas eliminar el vehículo <strong>{vehiculo.Patente}</strong>?</p>
                <div class='alert alert-warning'>
                    <i class='bi bi-exclamation-triangle me-2'></i>
                    Esta acción también eliminará todas las reservas asociadas a este vehículo.
                </div>
            ",
            Icon = SweetAlertIcon.Warning,
            ShowCancelButton = true,
            ConfirmButtonText = "Sí, Eliminar",
            CancelButtonText = "Cancelar",
            ConfirmButtonColor = "#dc3545"
        });

        if (resultado.IsConfirmed)
        {
            try
            {
                await _vehiculoService.DeleteAsync(vehiculo.Id);
                await _sweetAlert.FireAsync("¡Eliminado!", "Vehículo eliminado correctamente", SweetAlertIcon.Success);
                await CargarVehiculos();
                StateHasChanged();
            }
            catch (Exception ex)
            {
                await _sweetAlert.FireAsync("Error", $"No se pudo eliminar el vehículo: {ex.Message}", SweetAlertIcon.Error);
            }
        }
    }

    // Métodos auxiliares para iconos y estilos
    private string GetVehiculoIcon(Service.Enums.TipoVehiculoEnum tipo)
    {
        return tipo switch
        {
            Service.Enums.TipoVehiculoEnum.Auto => "bi bi-car-front",
            Service.Enums.TipoVehiculoEnum.Moto => "bi bi-bicycle",
            Service.Enums.TipoVehiculoEnum.Camioneta => "bi bi-truck",
            Service.Enums.TipoVehiculoEnum.Bicicleta => "bi bi-bicycle",
            _ => "bi bi-car-front"
        };
    }

    private string GetVehiculoBorderClass(Service.Enums.TipoVehiculoEnum tipo)
    {
        return tipo switch
        {
            Service.Enums.TipoVehiculoEnum.Auto => "border-primary",
            Service.Enums.TipoVehiculoEnum.Moto => "border-warning",
            Service.Enums.TipoVehiculoEnum.Camioneta => "border-success",
            Service.Enums.TipoVehiculoEnum.Bicicleta => "border-info",
            _ => "border-primary"
        };
    }
}

<style>
    .avatar-lg {
        width: 4rem;
        height: 4rem;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);
    }
    
    .bg-success-subtle {
        background-color: rgba(25, 135, 84, 0.1) !important;
    }
    
    .text-success {
        color: #198754 !important;
    }
    
    .bg-info-subtle {
        background-color: rgba(13, 202, 240, 0.1) !important;
    }
    
    .text-info {
        color: #0dcaf0 !important;
    }

    .dropdown-toggle::after {
        display: none;
    }
</style>